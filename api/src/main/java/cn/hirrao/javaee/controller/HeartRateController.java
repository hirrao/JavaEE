package cn.hirrao.javaee.controller;

import cn.hirrao.javaee.entity.Result;
import cn.hirrao.javaee.service.HeartRateService;
import cn.hirrao.javaee.utils.SnowFlake;
import cn.hirrao.javaee.utils.StringUtil;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.web.bind.annotation.*;

import java.util.Map;

@RestController
@RequestMapping("/heartRate")
public class HeartRateController {
    private final Logger logger = LoggerFactory.getLogger(getClass());
    private final SnowFlake snowFlake = new SnowFlake(1, 3);
    private final HeartRateService heartRateService;

    public HeartRateController(HeartRateService heartRateService) {
        this.heartRateService = heartRateService;
    }

    @GetMapping("/searchHRById")
    public Result searchHRById(@RequestBody Map<String, String> map) {
        logger.debug("通过id查找心率信息{}", map);
        var userId = Long.parseLong(map.get("userId"));
        var result = heartRateService.searchHeartRateById(userId);
        return Result.success(result);
    }

    @PostMapping("/insertHR")
    public Result insertHR(@RequestBody Map<String, String> map) {
        logger.debug("插入心率信息{}", map);
        var userId = map.get("userId");
        var heartRate = map.get("heartRate");
        var date = map.get("date");
        if (StringUtil.isEmpty(userId) || StringUtil.isEmpty(heartRate) || StringUtil.isEmpty(date)) {
            return Result.error(101, "错误输入");
        }
        heartRateService.insertHeartRate(snowFlake.nextId(), Long.parseLong(userId), Float.parseFloat(heartRate), date);
        return Result.success();
    }
}
